y21 <- read.table("2021_Russian_data.csv", sep=",", h=TRUE, stringsAsFactors=TRUE)
y22 <- read.table("2022_Russian_data.csv", sep=",", h=TRUE, stringsAsFactors=TRUE)

real21 <- subset(y21, y21$REGIONAL_STATUS=="Победитель" | y21$REGIONAL_STATUS=="Призер" | y21$REGIONAL_STATUS=="Участник" | y21$REGIONAL_STATUS=="")#participated, not disqualified
real219 <- subset(y21, (y21$REGIONAL_STATUS=="Победитель" | y21$REGIONAL_STATUS=="Призер" | y21$REGIONAL_STATUS=="Участник" | y21$REGIONAL_STATUS=="") & y21$GRADE_OF_COMPETITION==9)
real2110 <- subset(y21, (y21$REGIONAL_STATUS=="Победитель" | y21$REGIONAL_STATUS=="Призер" | y21$REGIONAL_STATUS=="Участник" | y21$REGIONAL_STATUS=="") & y21$GRADE_OF_COMPETITION==10)
real2111 <- subset(y21, (y21$REGIONAL_STATUS=="Победитель" | y21$REGIONAL_STATUS=="Призер" | y21$REGIONAL_STATUS=="Участник" | y21$REGIONAL_STATUS=="") & y21$GRADE_OF_COMPETITION==11)
awards21 <- subset(y21, y21$REGIONAL_STATUS=="Победитель" | y21$REGIONAL_STATUS=="Призер")#y21 awarded
first21 <- subset(y21, y21$REGIONAL_STATUS=="Победитель")#y21 first prizes
second21 <- subset(y21, y21$REGIONAL_STATUS=="Призер")#y21 second prizes
rest21 <- subset(y21, (y21$REGIONAL_STATUS=="Участник" | y21$REGIONAL_STATUS==""))
awards219 <- subset(y21, (y21$REGIONAL_STATUS=="Победитель" | y21$REGIONAL_STATUS=="Призер") & y21$GRADE_OF_COMPETITION==9)
awards2110 <- subset(y21, (y21$REGIONAL_STATUS=="Победитель" | y21$REGIONAL_STATUS=="Призер") & y21$GRADE_OF_COMPETITION==10)
awards2111 <- subset(y21, (y21$REGIONAL_STATUS=="Победитель" | y21$REGIONAL_STATUS=="Призер") & y21$GRADE_OF_COMPETITION==11)
first219 <- subset(y21, y21$REGIONAL_STATUS=="Победитель" & y21$GRADE_OF_COMPETITION==9)
first2110 <- subset(y21, y21$REGIONAL_STATUS=="Победитель" & y21$GRADE_OF_COMPETITION==10)
first2111 <- subset(y21, y21$REGIONAL_STATUS=="Победитель" & y21$GRADE_OF_COMPETITION==11)
second219 <- subset(y21, y21$REGIONAL_STATUS=="Призер" & y21$GRADE_OF_COMPETITION==9)
second2110 <- subset(y21, y21$REGIONAL_STATUS=="Призер" & y21$GRADE_OF_COMPETITION==10)
second2111 <- subset(y21, y21$REGIONAL_STATUS=="Призер" & y21$GRADE_OF_COMPETITION==11)
rest219 <- subset(y21, (y21$REGIONAL_STATUS=="Участник" | y21$REGIONAL_STATUS=="") & y21$GRADE_OF_COMPETITION==9)
rest2110 <- subset(y21, (y21$REGIONAL_STATUS=="Участник" | y21$REGIONAL_STATUS=="") & y21$GRADE_OF_COMPETITION==10)
rest2111 <- subset(y21, (y21$REGIONAL_STATUS=="Участник" | y21$REGIONAL_STATUS=="") & y21$GRADE_OF_COMPETITION==11)

real22 <- subset(y22, y22$REGIONAL_STATUS=="Победитель" | y22$REGIONAL_STATUS=="Призер" | y22$REGIONAL_STATUS=="Участник" | y22$REGIONAL_STATUS=="")#participated, not disqualified
real229 <- subset(y22, (y22$REGIONAL_STATUS=="Победитель" | y22$REGIONAL_STATUS=="Призер" | y22$REGIONAL_STATUS=="Участник" | y22$REGIONAL_STATUS=="") & y22$GRADE_OF_COMPETITION==9)
real2210 <- subset(y22, (y22$REGIONAL_STATUS=="Победитель" | y22$REGIONAL_STATUS=="Призер" | y22$REGIONAL_STATUS=="Участник" | y22$REGIONAL_STATUS=="") & y22$GRADE_OF_COMPETITION==10)
real2211 <- subset(y22, (y22$REGIONAL_STATUS=="Победитель" | y22$REGIONAL_STATUS=="Призер" | y22$REGIONAL_STATUS=="Участник" | y22$REGIONAL_STATUS=="") & y22$GRADE_OF_COMPETITION==11)
awards22 <- subset(y22, y22$REGIONAL_STATUS=="Победитель" | y22$REGIONAL_STATUS=="Призер")#y22 awarded
first22 <- subset(y22, y22$REGIONAL_STATUS=="Победитель")#y22 first prizes
second22 <- subset(y22, y22$REGIONAL_STATUS=="Призер")#y22 second prizes
rest22 <- subset(y22, (y22$REGIONAL_STATUS=="Участник" | y22$REGIONAL_STATUS==""))
awards229 <- subset(y22, (y22$REGIONAL_STATUS=="Победитель" | y22$REGIONAL_STATUS=="Призер") & y22$GRADE_OF_COMPETITION==9)
awards2210 <- subset(y22, (y22$REGIONAL_STATUS=="Победитель" | y22$REGIONAL_STATUS=="Призер") & y22$GRADE_OF_COMPETITION==10)
awards2211 <- subset(y22, (y22$REGIONAL_STATUS=="Победитель" | y22$REGIONAL_STATUS=="Призер") & y22$GRADE_OF_COMPETITION==11)
first229 <- subset(y22, y22$REGIONAL_STATUS=="Победитель" & y22$GRADE_OF_COMPETITION==9)
first2210 <- subset(y22, y22$REGIONAL_STATUS=="Победитель" & y22$GRADE_OF_COMPETITION==10)
first2211 <- subset(y22, y22$REGIONAL_STATUS=="Победитель" & y22$GRADE_OF_COMPETITION==11)
second229 <- subset(y22, y22$REGIONAL_STATUS=="Призер" & y22$GRADE_OF_COMPETITION==9)
second2210 <- subset(y22, y22$REGIONAL_STATUS=="Призер" & y22$GRADE_OF_COMPETITION==10)
second2211 <- subset(y22, y22$REGIONAL_STATUS=="Призер" & y22$GRADE_OF_COMPETITION==11)
rest229 <- subset(y22, (y22$REGIONAL_STATUS=="Участник" | y22$REGIONAL_STATUS=="") & y22$GRADE_OF_COMPETITION==9)
rest2210 <- subset(y22, (y22$REGIONAL_STATUS=="Участник" | y22$REGIONAL_STATUS=="") & y22$GRADE_OF_COMPETITION==10)
rest2211 <- subset(y22, (y22$REGIONAL_STATUS=="Участник" | y22$REGIONAL_STATUS=="") & y22$GRADE_OF_COMPETITION==11)

first <- rbind(first21, first22)
first9 <- rbind(first219, first229)
first10 <- rbind(first2110, first2210)
first11 <- rbind(first2111, first2211)
second <- rbind(second21, second22)
second9 <- rbind(second219, second229)
second10 <- rbind(second2110, second2210)
second11 <- rbind(second2111, second2211)
rest <- rbind(rest21, rest22)
rest9 <- rbind(rest219, rest229)
rest10 <- rbind(rest2110, rest2210)
rest11 <- rbind(rest2111, rest2211)

#plotting year-to-year change in percentages
png("2022_to_2021_in_first_prizes.png", h=1080, w=1920)
par(mar=c(20,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=2)
plot(subset(first, first$YEAR==2021)$PERCENTAGE ~ subset(first, first$YEAR==2021)$REGION, ylim=c(0, 100), col=rgb(0,0,0,.05), xlab="", ylab="Процент выполнения", main="Процент выполнения победителями (серое — 2021, красное — 2022)")
plot(subset(first, first$YEAR==2022)$PERCENTAGE ~ subset(first, first$YEAR==2022)$REGION, xaxt="n", add=TRUE, col=rgb(1,0,0,.05), border=rgb(1,0,0,1))
dev.off()

png("2022_to_2021_in_first_prizes_in_9.png", h=1080, w=1920)
par(mar=c(20,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=2)
plot(subset(first, first$YEAR==2021 & first$GRADE_OF_COMPETITION==9)$PERCENTAGE ~ subset(first, first$YEAR==2021 & first$GRADE_OF_COMPETITION==9)$REGION, ylim=c(0, 100), col=rgb(0,0,0,.05), xlab="", ylab="Процент выполнения", main="Процент выполнения победителями, 9 класс (серое — 2021, красное — 2022)")
plot(subset(first, first$YEAR==2022 & first$GRADE_OF_COMPETITION==9)$PERCENTAGE ~ subset(first, first$YEAR==2022 & first$GRADE_OF_COMPETITION==9)$REGION, xaxt="n", add=TRUE, col=rgb(1,0,0,.05), border=rgb(1,0,0,1))
dev.off()

png("2022_to_2021_in_first_prizes_in_10.png", h=1080, w=1920)
par(mar=c(20,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=2)
plot(subset(first, first$YEAR==2021 & first$GRADE_OF_COMPETITION==10)$PERCENTAGE ~ subset(first, first$YEAR==2021 & first$GRADE_OF_COMPETITION==10)$REGION, ylim=c(0, 100), col=rgb(0,0,0,.05), xlab="", ylab="Процент выполнения", main="Процент выполнения победителями, 10 класс (серое — 2021, красное — 2022)")
plot(subset(first, first$YEAR==2022 & first$GRADE_OF_COMPETITION==10)$PERCENTAGE ~ subset(first, first$YEAR==2022 & first$GRADE_OF_COMPETITION==10)$REGION, xaxt="n", add=TRUE, col=rgb(1,0,0,.05), border=rgb(1,0,0,1))
dev.off()

png("2022_to_2021_in_first_prizes_in_11.png", h=1080, w=1920)
par(mar=c(20,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=2)
plot(subset(first, first$YEAR==2021 & first$GRADE_OF_COMPETITION==11)$PERCENTAGE ~ subset(first, first$YEAR==2021 & first$GRADE_OF_COMPETITION==11)$REGION, ylim=c(0, 100), col=rgb(0,0,0,.05), xlab="", ylab="Процент выполнения", main="Процент выполнения победителями, 11 класс (серое — 2021, красное — 2022)")
plot(subset(first, first$YEAR==2022 & first$GRADE_OF_COMPETITION==11)$PERCENTAGE ~ subset(first, first$YEAR==2022 & first$GRADE_OF_COMPETITION==11)$REGION, xaxt="n", add=TRUE, col=rgb(1,0,0,.05), border=rgb(1,0,0,1))
dev.off()

png("2022_to_2021_in_second_prizes.png", h=1080, w=1920)
par(mar=c(20,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=2)
plot(subset(second, second$YEAR==2021)$PERCENTAGE ~ subset(second, second$YEAR==2021)$REGION, ylim=c(0, 100), col=rgb(0,0,0,.05), xlab="", ylab="Процент выполнения", main="Процент выполнения призёрами (серое — 2021, синее — 2022)")
plot(subset(second, second$YEAR==2022)$PERCENTAGE ~ subset(second, second$YEAR==2022)$REGION, xaxt="n", add=TRUE, col=rgb(0,0,1,.05), border=rgb(0,0,1,1))
dev.off()

png("2022_to_2021_in_second_prizes_in_9.png", h=1080, w=1920)
par(mar=c(20,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=2)
plot(subset(second, second$YEAR==2021 & second$GRADE_OF_COMPETITION==9)$PERCENTAGE ~ subset(second, second$YEAR==2021 & second$GRADE_OF_COMPETITION==9)$REGION, ylim=c(0, 100), col=rgb(0,0,0,.05), xlab="", ylab="Процент выполнения", main="Процент выполнения призёрами, 9 класс (серое — 2021, синее — 2022)")
plot(subset(second, second$YEAR==2022 & second$GRADE_OF_COMPETITION==9)$PERCENTAGE ~ subset(second, second$YEAR==2022 & second$GRADE_OF_COMPETITION==9)$REGION, xaxt="n", add=TRUE, col=rgb(0,0,1,.05), border=rgb(0,0,1,1))
dev.off()

png("2022_to_2021_in_second_prizes_in_10.png", h=1080, w=1920)
par(mar=c(20,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=2)
plot(subset(second, second$YEAR==2021 & second$GRADE_OF_COMPETITION==10)$PERCENTAGE ~ subset(second, second$YEAR==2021 & second$GRADE_OF_COMPETITION==10)$REGION, ylim=c(0, 100), col=rgb(0,0,0,.05), xlab="", ylab="Процент выполнения", main="Процент выполнения призёрами, 10 класс (серое — 2021, синее — 2022)")
plot(subset(second, second$YEAR==2022 & second$GRADE_OF_COMPETITION==10)$PERCENTAGE ~ subset(second, second$YEAR==2022 & second$GRADE_OF_COMPETITION==10)$REGION, xaxt="n", add=TRUE, col=rgb(0,0,1,.05), border=rgb(0,0,1,1))
dev.off()

png("2022_to_2021_in_second_prizes_in_11.png", h=1080, w=1920)
par(mar=c(20,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=2)
plot(subset(second, second$YEAR==2021 & second$GRADE_OF_COMPETITION==11)$PERCENTAGE ~ subset(second, second$YEAR==2021 & second$GRADE_OF_COMPETITION==11)$REGION, ylim=c(0, 100), col=rgb(0,0,0,.05), xlab="", ylab="Процент выполнения", main="Процент выполнения призёрами, 11 класс (серое — 2021, синее — 2022)")
plot(subset(second, second$YEAR==2022 & second$GRADE_OF_COMPETITION==11)$PERCENTAGE ~ subset(second, second$YEAR==2022 & second$GRADE_OF_COMPETITION==11)$REGION, xaxt="n", add=TRUE, col=rgb(0,0,1,.05), border=rgb(0,0,1,1))
dev.off()

png("2022_to_2021_in_unawarded.png", h=1080, w=1920)
par(mar=c(20,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=2)
plot(subset(rest, rest$YEAR==2021)$PERCENTAGE ~ subset(rest, rest$YEAR==2021)$REGION, ylim=c(0, 100), col=rgb(0,0,0,.05), xlab="", ylab="Процент выполнения", main="Процент выполнения ненаграждёнными участниками (серое — 2021, зелёное — 2022)")
plot(subset(rest, rest$YEAR==2022)$PERCENTAGE ~ subset(rest, rest$YEAR==2022)$REGION, xaxt="n", add=TRUE, col=rgb(0,1,0,.05), border=rgb(0,1,0,1))
dev.off()

png("2022_to_2021_in_unawarded_in_9.png", h=1080, w=1920)
par(mar=c(20,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=2)
plot(subset(rest, rest$YEAR==2021 & rest$GRADE_OF_COMPETITION==9)$PERCENTAGE ~ subset(rest, rest$YEAR==2021 & rest$GRADE_OF_COMPETITION==9)$REGION, ylim=c(0, 100), col=rgb(0,0,0,.05), xlab="", ylab="Процент выполнения", main="Процент выполнения ненаграждёнными участниками, 9 класс (серое — 2021, зелёное — 2022)")
plot(subset(rest, rest$YEAR==2022 & rest$GRADE_OF_COMPETITION==9)$PERCENTAGE ~ subset(rest, rest$YEAR==2022 & rest$GRADE_OF_COMPETITION==9)$REGION, xaxt="n", add=TRUE, col=rgb(0,1,0,.05), border=rgb(0,1,0,1))
dev.off()

png("2022_to_2021_in_unawarded_in_10.png", h=1080, w=1920)
par(mar=c(20,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=2)
plot(subset(rest, rest$YEAR==2021 & rest$GRADE_OF_COMPETITION==10)$PERCENTAGE ~ subset(rest, rest$YEAR==2021 & rest$GRADE_OF_COMPETITION==10)$REGION, ylim=c(0, 100), col=rgb(0,0,0,.05), xlab="", ylab="Процент выполнения", main="Процент выполнения ненаграждёнными участниками, 10 класс (серое — 2021, зелёное — 2022)")
plot(subset(rest, rest$YEAR==2022 & rest$GRADE_OF_COMPETITION==10)$PERCENTAGE ~ subset(rest, rest$YEAR==2022 & rest$GRADE_OF_COMPETITION==10)$REGION, xaxt="n", add=TRUE, col=rgb(0,1,0,.05), border=rgb(0,1,0,1))
dev.off()

png("2022_to_2021_in_unawarded_in_11.png", h=1080, w=1920)
par(mar=c(20,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=2)
plot(subset(rest, rest$YEAR==2021 & rest$GRADE_OF_COMPETITION==11)$PERCENTAGE ~ subset(rest, rest$YEAR==2021 & rest$GRADE_OF_COMPETITION==11)$REGION, ylim=c(0, 100), col=rgb(0,0,0,.05), xlab="", ylab="Процент выполнения", main="Процент выполнения ненаграждёнными участниками, 11 класс (серое — 2021, зелёное — 2022)")
plot(subset(rest, rest$YEAR==2022 & rest$GRADE_OF_COMPETITION==11)$PERCENTAGE ~ subset(rest, rest$YEAR==2022 & rest$GRADE_OF_COMPETITION==11)$REGION, xaxt="n", add=TRUE, col=rgb(0,1,0,.05), border=rgb(0,1,0,1))
dev.off()

#plotting year-to-year changes in mean percentages for different categories of participants
library(dplyr)
first21_by_region <- first21 %>% group_by(REGION) %>% summarize(MEAN=mean(PERCENTAGE))
first22_by_region <- first22 %>% group_by(REGION) %>% summarize(MEAN=mean(PERCENTAGE))
first21first22 <- merge(first21_by_region, first22_by_region, by="REGION")
second21_by_region <- second21 %>% group_by(REGION) %>% summarize(MEAN=mean(PERCENTAGE))
second22_by_region <- second22 %>% group_by(REGION) %>% summarize(MEAN=mean(PERCENTAGE))
second21second22 <- merge(second21_by_region, second22_by_region, by="REGION")
rest21_by_region <- rest21 %>% group_by(REGION) %>% summarize(MEAN=mean(PERCENTAGE))
rest22_by_region <- rest22 %>% group_by(REGION) %>% summarize(MEAN=mean(PERCENTAGE))
rest21rest22 <- merge(rest21_by_region, rest22_by_region, by="REGION")

png("2022_to_2021_change_in_means.png", h=1080, w=1920)
par(mar=c(20,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=2)
plot(first21first22$REGION, first21first22$MEAN.y - first21first22$MEAN.x, border="red", ylim=c(-33, 33), xlab="", ylab="Изменение процента выполнения в 2022 по сравнению с 2021", main="Изменение среднего процента выполнения участниками с различным статусом в 2022 году по сравнению с 2021 годом (пунктир — средние от средних по регионам)")
plot(second21second22$REGION, second21second22$MEAN.y - second21second22$MEAN.x, border="blue", add=TRUE, xaxt="n")
plot(rest21rest22$REGION, rest21rest22$MEAN.y - rest21rest22$MEAN.x, border="green", add=TRUE, xaxt="n")
abline(h=mean(first21first22$MEAN.y - first21first22$MEAN.x, na.rm=TRUE), col=rgb(1,0,0,.5), lty=2)
abline(h=mean(second21second22$MEAN.y - second21second22$MEAN.x, na.rm=TRUE), col=rgb(0,0,1,.5), lty=2)
abline(h=mean(rest21rest22$MEAN.y - rest21rest22$MEAN.x, na.rm=TRUE), col=rgb(0,1,0,.5), lty=2)
legend("topright", c("победители", "призёры", "прочие участники"), col=c("red", "blue", "green"),
lty=1, lwd=3, pch="", cex=1.5)
dev.off()

#plotting year-to-year changes in mean percentages as a function of 2021 means
real21notwo <- subset(real21, real21$WINNERS_ONLY==FALSE)
real22notwo <- subset(real22, real21$WINNERS_ONLY==FALSE)
real21_by_region <- real21notwo %>% group_by(REGION) %>% summarize(MEAN=mean(PERCENTAGE))
real22_by_region <- real22notwo %>% group_by(REGION) %>% summarize(MEAN=mean(PERCENTAGE))
real21real22 <- merge(real21_by_region, real22_by_region, by="REGION")

png("2022_to_2021_change_in_means_by_2021_percentage.png", h=1080, w=1920)
par(mar=c(6,6,3,1)+0.1, cex.axis=1.5, cex.lab=1.5, cex.main=1.5, las=1)
plot(real21real22$MEAN.x, real21real22$MEAN.y - real21real22$MEAN.x, main=paste("Изменение среднего процента выполнения в 2022 году по сравнению с 2021 годом в зависимости от среднего процента за 2021 год (y = ", round(lm(real21real22$MEAN.y - real21real22$MEAN.x ~ real21real22$MEAN.x)$coefficients[1], 2), " + ", round(lm(real21real22$MEAN.y - real21real22$MEAN.x ~ real21real22$MEAN.x)$coefficients[2], 2), "* x)"), xlab="Средний процент выполнения в 2021", ylab="Изменение процента выполнения в 2022 по сравнению с 2021", pch="")
text(real21real22$MEAN.x, real21real22$MEAN.y - real21real22$MEAN.x, labels=real21real22$REGION)
abline(lm(real21real22$MEAN.y - real21real22$MEAN.x ~ real21real22$MEAN.x), lty=2)
dev.off()

